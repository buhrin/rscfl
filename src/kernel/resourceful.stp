#!/usr/bin/stap -g

/*--------------------------------
 * global probes (init/cleanup)
 */

probe begin
{
  if (probes_start()) {
    print("rscfl: unable to initialise\n");
    exit();
  } else {
    print("rscfl: running\n");
  }
}

probe end
{
  if (probes_end()) {
    print("rscfl: unable to cleanup\n");
    exit();
  }
}

/*--------------------------------
 * scheduler interposition
 */

probe rscfl.sched.ctxswitch,
      rscfl.sched.migrate,
      rscfl.sched.task_exit
{
}

function _syscall(name:string) %{
  syscall_for_pid(STAP_ARG_name);
%}

probe syscall.* {
  _syscall(probefunc());

}
